<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #000; color: white; font-family: Tahoma, sans-serif; text-align: center; padding: 20px; }
        .container { border: 1px solid #333; padding: 20px; border-radius: 15px; background: #111; }
        input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #444; background: #222; color: white; margin-bottom: 15px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: linear-gradient(45deg, #f09433, #e1306c, #bc1888); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        #loader { display: none; margin-top: 15px; color: #f09433; }
        .download-btn { display: inline-block; margin-top: 20px; padding: 10px 20px; background: #28a745; color: white; text-decoration: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>اینستا دانلودر (TMA)</h2>
        <p>لینک پست یا ریلز را وارد کنید:</p>
        <input type="text" id="instaUrl" placeholder="https://www.instagram.com/p/..." />
        <button onclick="fetchVideo()">دریافت ویدیو</button>
        
        <div id="loader">در حال دریافت اطلاعات...</div>
        <div id="result"></div>
    </div>

    <script>
        async function fetchVideo() {
            const url = document.getElementById('instaUrl').value;
            const resultDiv = document.getElementById('result');
            const loader = document.getElementById('loader');

            if (!url) { alert("لطفاً لینک را وارد کنید"); return; }

            loader.style.display = "block";
            resultDiv.innerHTML = "";

            try {
                // استفاده از یک API عمومی برای تست (توجه: این APIها ممکن است بعد از مدتی تغییر کنند)
                const response = await fetch(`https://api.vkrhost.com/api/download?url=${encodeURIComponent(url)}`);
                const data = await response.json();

                loader.style.display = "none";

                if (data.status && data.data && data.data.length > 0) {
                    const videoUrl = data.data[0].url;
                    resultDiv.innerHTML = `
                        <p style="color: #28a745;">ویدیو آماده است!</p>
                        <a href="${videoUrl}" target="_blank" class="download-btn">دانلود / مشاهده ویدیو</a>
                    `;
                } else {
                    resultDiv.innerHTML = "<p style="color:red">خطا! لینک معتبر نیست یا پست خصوصی (Private) است.</p>";
                }
            } catch (error) {
                loader.style.display = "none";
                resultDiv.innerHTML = "<p style="color:red">مشکلی در سرور پیش آمد. دوباره تلاش کنید.</p>";
            }
        }
        
        // تنظیم مینی‌اپ برای تلگرام
        const tg = window.Telegram.WebApp;
        tg.expand(); // باز شدن کامل صفحه
    </script>
</body>
</html>
